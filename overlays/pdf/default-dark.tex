% ---------- Base packages ----------
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{svg}
\usepackage{fontspec}
\usepackage{xcolor}
\usepackage{caption}
\usepackage{listings}
\usepackage{minted}
\usepackage[many]{tcolorbox}
\tcbuselibrary{listings,skins,breakable}
\usepackage{needspace}
\usepackage[margin=2.5cm]{geometry}

% ---------- Fonts ----------
\setmainfont{FiraCode Nerd Font}
\setsansfont{FiraCode Nerd Font}
\setmonofont{FiraCode Nerd Font}

% ---------- Colors ----------
\definecolor{bg}{HTML}{282828}
\definecolor{darkred}{HTML}{cc241d}
\definecolor{darkgreen}{HTML}{98971a}
\definecolor{darkyellow}{HTML}{d79921}
\definecolor{darkblue}{HTML}{458588}
\definecolor{darkpurple}{HTML}{b16286}
\definecolor{darkaqua}{HTML}{689d6a}
\definecolor{darkgray}{HTML}{928374}
\definecolor{bg0h}{HTML}{1d2021}
\definecolor{darkorange}{HTML}{d65d0e}
\definecolor{fg4}{HTML}{a89984}
\definecolor{fg0}{HTML}{fbf1c7}

\colorlet{primary}{fg0}
\colorlet{secondary}{bg}
\colorlet{tertiary}{darkgreen}

\pagecolor{secondary}
\color{primary}

% ---------- Captions ----------
\captionsetup{
  width=0.8\textwidth,
  labelformat=empty
}

% ---------- SVG ----------
\newcommand{\fixsvg}[1]{
  \immediate\write18{perl -pi -e 's/fill="(?!none")[^"]+"/fill="\#fbf1c7"/g; s/stroke="(?!none")[^"]+"/stroke="\#fbf1c7"/g; s/font-family="[^"]*"/font-family="FiraCode Nerd Font"/g; s/font-size="[^"]*"/font-size="16pt"/g; s/ style="[^"]*"//g' #1.svg}
}


% --------- Minted ---------
\setminted{
  fontsize=\small,
  fontfamily=tt,
  linenos=false,
  numbersep=5pt,
  xleftmargin=0pt,
  xrightmargin=0pt,
  style=gruvbox-dark,
  texcomments=true,
  escapeinside=||
}
\newtcolorbox{codeblock}[2][]{
  enhanced,
  breakable,
  colback=bg0h,
  coltext=primary,
  boxrule=0pt,
  arc=6pt,
  outer arc=6pt,
  left=6pt,
  right=6pt,
  top=28pt,
  bottom=6pt,
  fontupper=\sffamily\small\color{primary},
  overlay={
    \node[anchor=north west, font=\footnotesize\sffamily, text=primary, xshift=6pt, yshift=-6pt]
      at (frame.north west) {#2};
  },
  #1
}


